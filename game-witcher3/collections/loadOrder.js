"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.importLoadOrder = exports.exportLoadOrder = void 0;
const vortex_api_1 = require("vortex-api");
const common_1 = require("../common");
const util_1 = require("./util");
async function exportLoadOrder(state, modIds, mods) {
    const profileId = vortex_api_1.selectors.lastActiveProfileForGame(state, common_1.GAME_ID);
    if (profileId === undefined) {
        return Promise.reject(new util_1.CollectionGenerateError('Invalid profile id'));
    }
    const loadOrder = state?.persistent?.loadOrder?.[profileId];
    if (loadOrder === undefined) {
        return Promise.resolve(undefined);
    }
    const includedMods = modIds.reduce((accum, iter) => {
        if (mods[iter] !== undefined) {
            accum[iter] = mods[iter];
        }
        return accum;
    }, {});
    const filteredLO = (0, util_1.genCollectionLoadOrder)(loadOrder, includedMods);
    return Promise.resolve(filteredLO);
}
exports.exportLoadOrder = exportLoadOrder;
async function importLoadOrder(api, collection) {
    const state = api.getState();
    const profileId = vortex_api_1.selectors.lastActiveProfileForGame(state, common_1.GAME_ID);
    if (profileId === undefined) {
        return Promise.reject(new util_1.CollectionParseError(collection?.['info']?.['name'] || '', 'Invalid profile id'));
    }
    api.store.dispatch(vortex_api_1.actions.setLoadOrder(profileId, collection.loadOrder));
    return Promise.resolve(undefined);
}
exports.importLoadOrder = importLoadOrder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZE9yZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibG9hZE9yZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDJDQUF1RDtBQUN2RCxzQ0FBb0M7QUFHcEMsaUNBQ3dFO0FBRWpFLEtBQUssVUFBVSxlQUFlLENBQ25DLEtBQW1CLEVBQ25CLE1BQWdCLEVBQ2hCLElBQXFDO0lBRXJDLE1BQU0sU0FBUyxHQUFHLHNCQUFTLENBQUMsd0JBQXdCLENBQUMsS0FBSyxFQUFFLGdCQUFPLENBQUMsQ0FBQztJQUNyRSxJQUFJLFNBQVMsS0FBSyxTQUFTLEVBQUU7UUFDM0IsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksOEJBQXVCLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO0tBQzFFO0lBRUQsTUFBTSxTQUFTLEdBQUcsS0FBSyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM1RCxJQUFJLFNBQVMsS0FBSyxTQUFTLEVBQUU7UUFPM0IsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0tBQ25DO0lBRUQsTUFBTSxZQUFZLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBRTtRQUNqRCxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxTQUFTLEVBQUU7WUFDNUIsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUMxQjtRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ1AsTUFBTSxVQUFVLEdBQUcsSUFBQSw2QkFBc0IsRUFBQyxTQUFnQixFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQzFFLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNyQyxDQUFDO0FBN0JELDBDQTZCQztBQUVNLEtBQUssVUFBVSxlQUFlLENBQ25DLEdBQXdCLEVBQ3hCLFVBQThCO0lBRTlCLE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUU3QixNQUFNLFNBQVMsR0FBRyxzQkFBUyxDQUFDLHdCQUF3QixDQUFDLEtBQUssRUFBRSxnQkFBTyxDQUFDLENBQUM7SUFDckUsSUFBSSxTQUFTLEtBQUssU0FBUyxFQUFFO1FBQzNCLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLDJCQUFvQixDQUFDLFVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxFQUFFLG9CQUFvQixDQUFDLENBQUMsQ0FBQztLQUM3RztJQUVELEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLG9CQUFPLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsU0FBZ0IsQ0FBQyxDQUFDLENBQUM7SUFDakYsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ3BDLENBQUM7QUFiRCwwQ0FhQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFjdGlvbnMsIHNlbGVjdG9ycywgdHlwZXMgfSBmcm9tICd2b3J0ZXgtYXBpJztcbmltcG9ydCB7IEdBTUVfSUQgfSBmcm9tICcuLi9jb21tb24nO1xuaW1wb3J0IHsgSUxvYWRPcmRlciwgSUxvYWRPcmRlckVudHJ5LCBJVzNDb2xsZWN0aW9uc0RhdGEgfSBmcm9tICcuL3R5cGVzJztcblxuaW1wb3J0IHsgQ29sbGVjdGlvbkdlbmVyYXRlRXJyb3IsIENvbGxlY3Rpb25QYXJzZUVycm9yLFxuICBnZW5Db2xsZWN0aW9uTG9hZE9yZGVyLCBpc01vZEluQ29sbGVjdGlvbiwgaXNWYWxpZE1vZCB9IGZyb20gJy4vdXRpbCc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHBvcnRMb2FkT3JkZXIoXG4gIHN0YXRlOiB0eXBlcy5JU3RhdGUsXG4gIG1vZElkczogc3RyaW5nW10sXG4gIG1vZHM6IHsgW21vZElkOiBzdHJpbmddOiB0eXBlcy5JTW9kIH1cbik6IFByb21pc2U8SUxvYWRPcmRlcj4ge1xuICBjb25zdCBwcm9maWxlSWQgPSBzZWxlY3RvcnMubGFzdEFjdGl2ZVByb2ZpbGVGb3JHYW1lKHN0YXRlLCBHQU1FX0lEKTtcbiAgaWYgKHByb2ZpbGVJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBDb2xsZWN0aW9uR2VuZXJhdGVFcnJvcignSW52YWxpZCBwcm9maWxlIGlkJykpO1xuICB9XG5cbiAgY29uc3QgbG9hZE9yZGVyID0gc3RhdGU/LnBlcnNpc3RlbnQ/LmxvYWRPcmRlcj8uW3Byb2ZpbGVJZF07XG4gIGlmIChsb2FkT3JkZXIgPT09IHVuZGVmaW5lZCkge1xuICAgIC8vIFRoaXMgaXMgdGhlb3JldGljYWxseSBcImZpbmVcIiAtIHRoZSB1c2VyIG1heSBoYXZlIHNpbXBseVxuICAgIC8vICBkb3dubG9hZGVkIHRoZSBtb2RzIGFuZCBpbW1lZGlhdGVseSBjcmVhdGVkIHRoZSBjb2xsZWN0aW9uXG4gICAgLy8gIHdpdGhvdXQgYWN0dWFsbHkgc2V0dGluZyB1cCBhIGxvYWQgb3JkZXIuIEFsdGVybmF0aXZlbHlcbiAgICAvLyAgdGhlIGdhbWUgZXh0ZW5zaW9uIGl0c2VsZiBtaWdodCBiZSBoYW5kbGluZyB0aGUgcHJlc29ydCBmdW5jdGlvbmFsaXR5XG4gICAgLy8gIGVycm9uZW91c2x5LiBSZWdhcmRsZXNzLCB0aGUgY29sbGVjdGlvbiBjcmVhdGlvbiBzaG91bGRuJ3QgYmUgYmxvY2tlZFxuICAgIC8vICBieSB0aGUgaW5leGlzdGFuY2Ugb2YgYSBsb2FkT3JkZXIuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xuICB9XG5cbiAgY29uc3QgaW5jbHVkZWRNb2RzID0gbW9kSWRzLnJlZHVjZSgoYWNjdW0sIGl0ZXIpID0+IHtcbiAgICBpZiAobW9kc1tpdGVyXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBhY2N1bVtpdGVyXSA9IG1vZHNbaXRlcl07XG4gICAgfVxuICAgIHJldHVybiBhY2N1bTtcbiAgfSwge30pOyAvL0ZJWE1FICdMb2FkT3JkZXInIGlzIG5vdCB7W21vZElEOiBzdHJpbmddOiAnSUxvYWRPcmRlckVudHJ5W10nfVxuICBjb25zdCBmaWx0ZXJlZExPID0gZ2VuQ29sbGVjdGlvbkxvYWRPcmRlcihsb2FkT3JkZXIgYXMgYW55LCBpbmNsdWRlZE1vZHMpO1xuICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZpbHRlcmVkTE8pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW1wb3J0TG9hZE9yZGVyKFxuICBhcGk6IHR5cGVzLklFeHRlbnNpb25BcGksXG4gIGNvbGxlY3Rpb246IElXM0NvbGxlY3Rpb25zRGF0YVxuKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHN0YXRlID0gYXBpLmdldFN0YXRlKCk7XG5cbiAgY29uc3QgcHJvZmlsZUlkID0gc2VsZWN0b3JzLmxhc3RBY3RpdmVQcm9maWxlRm9yR2FtZShzdGF0ZSwgR0FNRV9JRCk7XG4gIGlmIChwcm9maWxlSWQgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgQ29sbGVjdGlvblBhcnNlRXJyb3IoY29sbGVjdGlvbj8uWydpbmZvJ10/LlsnbmFtZSddIHx8ICcnLCAnSW52YWxpZCBwcm9maWxlIGlkJykpO1xuICB9XG5cbiAgYXBpLnN0b3JlLmRpc3BhdGNoKGFjdGlvbnMuc2V0TG9hZE9yZGVyKHByb2ZpbGVJZCwgY29sbGVjdGlvbi5sb2FkT3JkZXIgYXMgYW55KSk7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKTtcbn1cbiJdfQ==