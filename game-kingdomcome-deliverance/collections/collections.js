"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseCollectionsData = exports.genCollectionsData = void 0;
const vortex_api_1 = require("vortex-api");
const loadOrder_1 = require("./loadOrder");
async function genCollectionsData(context, gameId, includedMods) {
    const api = context.api;
    try {
        const loadOrder = await (0, loadOrder_1.exportLoadOrder)(api.getState(), includedMods);
        const collectionData = {
            loadOrder: loadOrder,
        };
        return Promise.resolve(collectionData);
    }
    catch (err) {
        return Promise.reject(err);
    }
}
exports.genCollectionsData = genCollectionsData;
async function parseCollectionsData(context, gameId, collection) {
    const api = context.api;
    const state = api.getState();
    const profileId = vortex_api_1.selectors.lastActiveProfileForGame(state, gameId);
    const profile = vortex_api_1.selectors.profileById(state, profileId);
    if (profile?.gameId !== gameId) {
        return Promise.reject(new vortex_api_1.util.ProcessCanceled('Last active profile is missing'));
    }
    try {
        await (0, loadOrder_1.importLoadOrder)(api, collection);
    }
    catch (err) {
        return Promise.reject(err);
    }
}
exports.parseCollectionsData = parseCollectionsData;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sbGVjdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjb2xsZWN0aW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwyQ0FBb0Q7QUFHcEQsMkNBQStEO0FBRXhELEtBQUssVUFBVSxrQkFBa0IsQ0FDdEMsT0FBZ0MsRUFDaEMsTUFBYyxFQUNkLFlBQXNCO0lBRXRCLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7SUFDeEIsSUFBSTtRQUNGLE1BQU0sU0FBUyxHQUFHLE1BQU0sSUFBQSwyQkFBZSxFQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUN0RSxNQUFNLGNBQWMsR0FBd0I7WUFDMUMsU0FBUyxFQUFFLFNBQWdCO1NBQzVCLENBQUM7UUFDRixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7S0FDeEM7SUFBQyxPQUFPLEdBQUcsRUFBRTtRQUNaLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUM1QjtBQUNILENBQUM7QUFmRCxnREFlQztBQUVNLEtBQUssVUFBVSxvQkFBb0IsQ0FDeEMsT0FBZ0MsRUFDaEMsTUFBYyxFQUNkLFVBQStCO0lBRS9CLE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUM7SUFDeEIsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzdCLE1BQU0sU0FBUyxHQUFHLHNCQUFTLENBQUMsd0JBQXdCLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3BFLE1BQU0sT0FBTyxHQUFHLHNCQUFTLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsQ0FBQztJQUN4RCxJQUFJLE9BQU8sRUFBRSxNQUFNLEtBQUssTUFBTSxFQUFFO1FBQzlCLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLGlCQUFJLENBQUMsZUFBZSxDQUFDLGdDQUFnQyxDQUFDLENBQUMsQ0FBQztLQUNuRjtJQUNELElBQUk7UUFDRixNQUFNLElBQUEsMkJBQWUsRUFBQyxHQUFHLEVBQUUsVUFBVSxDQUFDLENBQUM7S0FDeEM7SUFBQyxPQUFPLEdBQUcsRUFBRTtRQUNaLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUM1QjtBQUNILENBQUM7QUFqQkQsb0RBaUJDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VsZWN0b3JzLCB0eXBlcywgdXRpbCB9IGZyb20gJ3ZvcnRleC1hcGknO1xuaW1wb3J0IHsgSUtDRENvbGxlY3Rpb25zRGF0YSB9IGZyb20gJy4vdHlwZXMnO1xuXG5pbXBvcnQgeyBleHBvcnRMb2FkT3JkZXIsIGltcG9ydExvYWRPcmRlciB9IGZyb20gJy4vbG9hZE9yZGVyJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbkNvbGxlY3Rpb25zRGF0YShcbiAgY29udGV4dDogdHlwZXMuSUV4dGVuc2lvbkNvbnRleHQsXG4gIGdhbWVJZDogc3RyaW5nLFxuICBpbmNsdWRlZE1vZHM6IHN0cmluZ1tdXG4pe1xuICBjb25zdCBhcGkgPSBjb250ZXh0LmFwaTtcbiAgdHJ5IHtcbiAgICBjb25zdCBsb2FkT3JkZXIgPSBhd2FpdCBleHBvcnRMb2FkT3JkZXIoYXBpLmdldFN0YXRlKCksIGluY2x1ZGVkTW9kcyk7XG4gICAgY29uc3QgY29sbGVjdGlvbkRhdGE6IElLQ0RDb2xsZWN0aW9uc0RhdGEgPSB7XG4gICAgICBsb2FkT3JkZXI6IGxvYWRPcmRlciBhcyBhbnksIC8vRklYTUUgJ0xvYWRPcmRlcicgaXMgbm90IHtbbW9kSUQ6IHN0cmluZ106ICdJTG9hZE9yZGVyRW50cnlbXSd9XG4gICAgfTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNvbGxlY3Rpb25EYXRhKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHBhcnNlQ29sbGVjdGlvbnNEYXRhKFxuICBjb250ZXh0OiB0eXBlcy5JRXh0ZW5zaW9uQ29udGV4dCxcbiAgZ2FtZUlkOiBzdHJpbmcsXG4gIGNvbGxlY3Rpb246IElLQ0RDb2xsZWN0aW9uc0RhdGFcbil7XG4gIGNvbnN0IGFwaSA9IGNvbnRleHQuYXBpO1xuICBjb25zdCBzdGF0ZSA9IGFwaS5nZXRTdGF0ZSgpO1xuICBjb25zdCBwcm9maWxlSWQgPSBzZWxlY3RvcnMubGFzdEFjdGl2ZVByb2ZpbGVGb3JHYW1lKHN0YXRlLCBnYW1lSWQpO1xuICBjb25zdCBwcm9maWxlID0gc2VsZWN0b3JzLnByb2ZpbGVCeUlkKHN0YXRlLCBwcm9maWxlSWQpO1xuICBpZiAocHJvZmlsZT8uZ2FtZUlkICE9PSBnYW1lSWQpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IHV0aWwuUHJvY2Vzc0NhbmNlbGVkKCdMYXN0IGFjdGl2ZSBwcm9maWxlIGlzIG1pc3NpbmcnKSk7XG4gIH1cbiAgdHJ5IHtcbiAgICBhd2FpdCBpbXBvcnRMb2FkT3JkZXIoYXBpLCBjb2xsZWN0aW9uKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gIH1cbn1cbiJdfQ==